(this["webpackJsonponline-stratego-client"]=this["webpackJsonponline-stratego-client"]||[]).push([[0],{106:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(57),r=a.n(o),l=(a(67),a(68),a(69),a(70),a(59)),i=a(21),c=a(9),d=a(13),u=a(15),h=a(14),b=a(4),m=a(16),g=a(30),y=a.n(g),p=a(31),v=function e(t,a,n){Object(c.a)(this,e),this.id=t,this.username=a,this.lobbyId=n},w=function e(t,a,n,s){Object(c.a)(this,e),this.id=t,this.username=a,this.lobbyId=n,this.color=s},f=function e(t,a){Object(c.a)(this,e),this.lobbyId=t,this.playerList=a},E=800,C=1e3,k=null,O=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).connect=function(){var e=Object(b.a)(a),t=new y.a("http://localhost:9000/ws");(k=p.Stomp.over(t)).connect({},(function(t){console.log(t.toString()),k.subscribe("/topic/game",(function(t){e.onMessageRecieved(t)})),e.sendMessage("/app/game",new w(e.state.user.id,e.state.user.username,e.state.lobbyId,e.state.color))}))},a.sendMessage=function(e,t){k.send(e,{},JSON.stringify(t)),console.log(t,"SEND")},a.toggle=function(){a.sendMessage("/app/game",{id:0,username:"ruudTest"})},a.state={user:null,lobbyId:null,color:null,mouseX:0,mouseY:0,ready:!1,board:[],pawns:[]},a.sendMessage=a.sendMessage.bind(Object(b.a)(a)),a.onMessageRecieved=a.onMessageRecieved.bind(Object(b.a)(a)),a.toggle=a.toggle.bind(Object(b.a)(a)),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.getSessionStorage(),this.getUser(),this.getLobbyId(),this.connect(),this.drawBoard()}},{key:"componentDidUpdate",value:function(e,t,a){this.state.board!==t.board&&this.drawBoard(),this.state.pawns!==t.pawns&&this.drawPawns(),console.log(this.state)}},{key:"getSessionStorage",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user")),lobbyId:sessionStorage.getItem("lobbyId"),color:sessionStorage.getItem("color")})}},{key:"getUser",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user"))})}},{key:"getLobbyId",value:function(){this.setState({lobbyId:sessionStorage.getItem("lobbyId")})}},{key:"drawBoard",value:function(){console.log("drawing board");for(var e=document.getElementById("canvasBoard").getContext("2d"),t=this.state.board,a=t.length,n=0;n<a;n++)for(var s=t[n],o=0;o<a;o++)!0===s[o]?e.fillStyle="green":!1===s[o]&&(e.fillStyle="blue"),e.fillRect(C/a*o,E/a*n,C/a-1,E/a-1)}},{key:"drawPawns",value:function(){console.log("draw pawns")}},{key:"onMessageRecieved",value:function(e){var t=JSON.parse(e.body);console.log(t,"recieved"),t.lobbyId===this.state.lobbyId&&"START_GAME"===t.operation&&this.setState({board:t.fields,pawns:t.pawnList})}},{key:"handleMouseClick",value:function(e){var t=e.nativeEvent.layerX,a=e.nativeEvent.layerY;t=Math.floor(t/100),a=Math.floor(a/80),this.setState({mouseX:t,mouseY:a})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{style:{paddingBottom:"3rem",fontSize:"40px"}},"Online Stratego"),s.a.createElement("div",{className:"row",id:"left"}),s.a.createElement("div",{className:"row",id:"center"},s.a.createElement("div",{className:"grid"},s.a.createElement("div",{className:"canvasWrapper"},s.a.createElement("canvas",{id:"canvasBoard",width:C,height:E,onMouseDown:this.handleMouseClick.bind(this)})),s.a.createElement("div",{className:"canvasWrapper"},s.a.createElement("canvas",{id:"canvasPawns",width:C,height:E,onMouseDown:this.handleMouseClick.bind(this)})))),s.a.createElement("div",{className:"row",id:"right"}),s.a.createElement("button",{onClick:this.toggle},"toggle"))}}]),t}(n.Component),S=a(107),I=a(24),N="http://localhost:9000";function j(e,t,a){if(t.length!==a.length)return"Parameter and values size does not match.";var n=[];n.push(N,"/",e,"?");for(var s=0;s<t.length;s++)n.push(t[s],"=",a[s],"&");return n.join("")}var L=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={username:"",password:"",user:null},a.handleLogin=a.handleLogin.bind(Object(b.a)(a)),a.handleRegister=a.handleRegister.bind(Object(b.a)(a)),a.handleChangeUsername=a.handleChangeUsername.bind(Object(b.a)(a)),a.handleChangePassword=a.handleChangePassword.bind(Object(b.a)(a)),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){sessionStorage.setItem("lobbyId","")}},{key:"componentDidUpdate",value:function(e,t,a){t!==this.state&&console.log(this.state)}},{key:"handleErrors",value:function(e){if(!e.ok)throw Error(e.statusText);return e}},{key:"handleLogin",value:function(){var e=this,t=j("login",["username","password"],[this.state.username,this.state.password]);fetch(t).then((function(e){return e.json()})).then((function(t){e.setState({user:t},(function(){console.log(e.state.user,"user"),e.state.user.id?"null"!==e.state.user.id?(console.log(e.state),sessionStorage.setItem("user",JSON.stringify(e.state.user)),window.location="/joinlobby"):window.alert("Could not find account with those credentials!"):window.alert("Could not fetch user!")}))}))}},{key:"handleRegister",value:function(){window.location="/register"}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Online Stratego"),s.a.createElement(S.a,{className:"Form",style:{backgroundColor:"rgba(235,200,70,0.9)"}},s.a.createElement(S.a.Group,null,s.a.createElement(S.a.Control,{className:"input",type:"text",id:"username",placeholder:"Username",autoComplete:"username",onChange:this.handleChangeUsername})),s.a.createElement(S.a.Group,null,s.a.createElement(S.a.Control,{className:"input",type:"password",id:"password",placeholder:"Password",autoComplete:"current-password",onChange:this.handleChangePassword})),s.a.createElement(S.a.Group,null,s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.handleLogin},"Login"),s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.handleRegister},"Register new account"))))}}]),t}(n.Component),M=null,P=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={user:null,lobbyId:null,playerList:[]},a.onMessageRecieved=a.onMessageRecieved.bind(Object(b.a)(a)),a.sendMessage=a.sendMessage.bind(Object(b.a)(a)),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.getSessionStorage(),this.connect()}},{key:"getSessionStorage",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user")),lobbyId:sessionStorage.getItem("lobbyId")})}},{key:"componentDidUpdate",value:function(e,t,a){console.log(this.state)}},{key:"connect",value:function(){var e=this,t=new y.a("http://localhost:9000/ws");(M=p.Stomp.over(t)).connect({},(function(t){console.log(t.toString()),M.subscribe("/topic/lobby",(function(t){e.onMessageRecieved(t)})),e.sendMessage("/app/lobby",new v(e.state.user.id,e.state.user.username,e.state.lobbyId))}))}},{key:"onMessageRecieved",value:function(e){var t=this,a=JSON.parse(e.body);console.log(a,"recieved"),console.log(this.state),a.receiver===this.state.user.id&&"NEW_LOBBY"===a.operation&&(this.setState({lobbyId:a.lobbyId,playerList:a.playerList}),sessionStorage.setItem("lobbyId",this.state.lobbyId)),a.lobbyId===this.state.lobbyId&&("JOINED_LOBBY"===a.operation?(this.setState({playerList:a.playerList}),this.state.playerList.forEach((function(e){e.id===t.state.user.id&&sessionStorage.setItem("color",e.color)}))):"START_GAME"===a.operation&&(window.location="/game"))}},{key:"sendMessage",value:function(e,t){M.send(e,{},JSON.stringify(t)),console.log(t,"SEND")}},{key:"getPlayer",value:function(e){var t=this.state.playerList[e];console.log(t,"player "+e)}},{key:"startGame",value:function(){console.log(this),this.sendMessage("/app/lobby/startgame",new f(this.state.lobbyId,this.state.playerList))}},{key:"createInfoBlockFromPlayer",value:function(e){if(this.state.playerList[e]){var t,a=this.state.playerList[e];return t="RED"===a.color?"rgba(200, 0, 0, 0.85":"BLUE"===a.color?"rgba(0, 0, 200, 0.85":"rgba(235, 200, 70, 0.85",s.a.createElement("div",{className:"Form player-info",style:{backgroundColor:t}},s.a.createElement("p",{className:"player-name"},a.username),s.a.createElement("p",{className:"player-info"},a.color))}return s.a.createElement("div",{className:"Form player-info",style:{backgroundColor:"rgba(235, 200, 70, 0.85)"}},s.a.createElement("p",{className:"player-name"},"Waiting for player.."))}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("div",{className:"row"},s.a.createElement("header",{className:"Header"},"Lobby:\xa0"),s.a.createElement("header",{className:"lobby-id"},this.state.lobbyId&&this.state.lobbyId)),s.a.createElement("div",{className:"container",style:{width:"60%"}},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm"},this.createInfoBlockFromPlayer(0)),s.a.createElement("div",{className:"col-sm"},this.createInfoBlockFromPlayer(1))),s.a.createElement("div",{className:"row",style:{paddingTop:"1rem"}},s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.startGame},"Start Game"))))}}]),t}(n.Component),U=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={username:"",password:"",user:null},a.handleLogin=a.handleLogin.bind(Object(b.a)(a)),a.handleRegister=a.handleRegister.bind(Object(b.a)(a)),a.handleChangeUsername=a.handleChangeUsername.bind(Object(b.a)(a)),a.handleChangePassword=a.handleChangePassword.bind(Object(b.a)(a)),a.handleChangePasswordConf=a.handleChangePasswordConf.bind(Object(b.a)(a)),a.toLogin=a.toLogin.bind(Object(b.a)(a)),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){t!==this.state&&console.log(this.state)}},{key:"handleErrors",value:function(e){if(!e.ok)throw Error(e.statusText);return e}},{key:"handleLogin",value:function(){window.location="/"}},{key:"handleRegister",value:function(){var e=this.state.username,t=this.state.password;if(t===this.state.passwordConfirmation)if("null"!==e){var a=j("register",["username","password"],[e,t]);fetch(a).then((function(e){return e.json()})).then((function(e){console.log(e,"data"),"null"!==e.id||"null"!==e.username?window.location="/":window.alert("Could not create account! Unkown error.")}))}else window.alert("Username cannot be null.");else window.alert("Passwords do not match.")}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleChangePasswordConf",value:function(e){this.setState({passwordConfirmation:e.target.value})}},{key:"toLogin",value:function(){window.location="/"}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Online Stratego"),s.a.createElement(S.a,{className:"Form",style:{backgroundColor:"rgba(235,200,70,0.9)"}},s.a.createElement(S.a.Group,null,s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.toLogin},"Back to login")),s.a.createElement(S.a.Group,null,s.a.createElement(S.a.Control,{className:"input",type:"text",id:"username",placeholder:"Username",onChange:this.handleChangeUsername})),s.a.createElement(S.a.Group,null,s.a.createElement(S.a.Control,{className:"input",type:"password",id:"password",placeholder:"Password",autoComplete:"new-password",onChange:this.handleChangePassword})),s.a.createElement(S.a.Group,null,s.a.createElement(S.a.Control,{className:"input",type:"password",id:"passwordConf",placeholder:"Confirm password",autoComplete:"new-password",onChange:this.handleChangePasswordConf})),s.a.createElement(S.a.Group,null,s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.handleRegister},"Create account"))))}}]),t}(n.Component),R=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={user:null,lobbyId:""},a.changeLobbyId=a.changeLobbyId.bind(Object(b.a)(a)),a.createLobby=a.createLobby.bind(Object(b.a)(a)),a.joinLobby=a.joinLobby.bind(Object(b.a)(a)),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.getUser()}},{key:"componentDidUpdate",value:function(e,t,a){console.log(this.state,"state")}},{key:"getUser",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user"))})}},{key:"changeLobbyId",value:function(e){this.setState({lobbyId:e.target.value.toUpperCase()})}},{key:"createLobby",value:function(){sessionStorage.setItem("lobbyId",""),window.location="/lobby"}},{key:"joinLobby",value:function(){5===this.state.lobbyId.length?(sessionStorage.setItem("lobbyId",this.state.lobbyId),window.location="/lobby"):window.alert("Lobby ID must be 5 characters!")}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Create or join lobby"),s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm"},s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.createLobby},"Create new lobby")),s.a.createElement("div",{className:"col-sm"},s.a.createElement(S.a.Group,null,s.a.createElement(I.a,{className:"btn btn-warning",onClick:this.joinLobby},"Join a private lobby"),s.a.createElement(S.a.Control,{className:"input upper-case",type:"text",id:"lobbyId",maxLength:"5",placeholder:"Lobby ID",onChange:this.changeLobbyId}))))))}}]),t}(n.Component);var B=function(){return s.a.createElement(l.a,null,s.a.createElement("div",{className:"App"},s.a.createElement(i.a,{path:"/",exact:!0,component:L}),s.a.createElement(i.a,{path:"/register",exact:!0,component:U}),s.a.createElement(i.a,{path:"/game",exact:!0,component:O}),s.a.createElement(i.a,{path:"/lobby",exact:!0,component:P}),s.a.createElement(i.a,{path:"/joinlobby",exact:!0,component:R})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},62:function(e,t,a){e.exports=a(106)},67:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){}},[[62,1,2]]]);
//# sourceMappingURL=main.d53dad9b.chunk.js.map