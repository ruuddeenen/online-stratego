(this["webpackJsonponline-stratego-client"]=this["webpackJsonponline-stratego-client"]||[]).push([[0],{121:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(69),r=a.n(o),l=(a(82),a(83),a(84),a(85),a(74)),i=a(21),c=a(70),d=a(9),u=a(13),m=a(15),h=a(14),g=a(4),b=a(16),p=a(31),w=a.n(p),y=a(32),f=function e(t,a,n){Object(d.a)(this,e),this.id=t,this.username=a,this.lobbyId=n},v=function e(t,a,n,s){Object(d.a)(this,e),this.id=t,this.username=a,this.lobbyId=n,this.color=s},E=function e(t,a){Object(d.a)(this,e),this.lobbyId=t,this.playerList=a},I=a(71),k=a.n(I),C=a(72),N=a.n(C),S=a(38),O=a.n(S),j=a(39),L=a.n(j),x=a(40),P=a.n(x),M=a(41),B=a.n(M),R=a(42),U=a.n(R),D=a(43),G=a.n(D),J=a(44),T=a.n(J),F=a(45),A=a.n(F),W=a(46),H=a.n(W),Y=a(47),_=a.n(Y),X=a(48),z=a.n(X),$=a(49),q=a.n($),K=a(24),Q={small:320,medium:640,big:800},V={small:400,medium:800,big:1e3},Z=null,ee=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).connect=function(){var e=Object(g.a)(a),t=new w.a("http://localhost:9000/ws");(Z=y.Stomp.over(t)).connect({},(function(){Z.subscribe("/topic/game",(function(t){e.onMessageRecieved(t)})),e.sendMessage("/app/game",new v(e.state.user.id,e.state.user.username,e.state.lobbyId,e.state.color))}))},a.sendMessage=function(e,t){Z.send(e,{},JSON.stringify(t)),console.log(t,"SEND")},a.state={user:null,opponent:null,lobbyId:null,color:null,mouseX:0,mouseY:0,ready:!1,board:[],pawns:[],selectedItem:null,images:[]},a.sendMessage=a.sendMessage.bind(Object(g.a)(a)),a.onMessageRecieved=a.onMessageRecieved.bind(Object(g.a)(a)),a}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e={grass:new Image,water:new Image,pawns:{sergeant:new Image,bomb:new Image,captain:new Image,colonel:new Image,flag:new Image,general:new Image,lieutenant:new Image,major:new Image,marshal:new Image,miner:new Image,scout:new Image,spy:new Image,test:new Image}};e.grass.src=k.a,e.water.src=N.a,e.pawns.bomb.src=O.a,e.pawns.captain.src=L.a,e.pawns.colonel.src=P.a,e.pawns.flag.src=B.a,e.pawns.general.src=U.a,e.pawns.lieutenant.src=G.a,e.pawns.major.src=T.a,e.pawns.marshal.src=A.a,e.pawns.miner.src=H.a,e.pawns.scout.src=_.a,e.pawns.sergeant=z.a,e.pawns.spy.src=q.a,this.setState({images:e})}},{key:"componentDidMount",value:function(){this.getSessionStorage(),this.getUser(),this.getLobbyId(),this.connect(),this.drawBoard(),this.drawPawns()}},{key:"componentDidUpdate",value:function(e,t,a){this.state.images&&(this.state.board!==t.board&&this.drawBoard(),this.state.pawns!==t.pawns&&this.drawPawns()),console.log(this.state,"state update")}},{key:"getSessionStorage",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user")),lobbyId:sessionStorage.getItem("lobbyId"),color:sessionStorage.getItem("color")})}},{key:"getUser",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user"))})}},{key:"getLobbyId",value:function(){this.setState({lobbyId:sessionStorage.getItem("lobbyId")})}},{key:"drawBoard",value:function(){var e=document.getElementById("canvasBoard"),t=e.getContext("2d"),a=this.state.board,n=a.length,s=e.width,o=e.height;t.fillStyle="black",t.fillRect(0,0,s,o);for(var r=0;r<n;r++)for(var l=a[r],i=0;i<n;i++){var c=void 0;!0===l[i]?c=this.state.images.grass:!1===l[i]&&(c=this.state.images.water),t.drawImage(c,s/n*i+1,o/n*r+1,s/n-1,o/n-1),r<4?(t.fillStyle=this.state.opponent.color,t.globalAlpha=.4,t.fillRect(s/n*i,o/n*r,s/n,o/n)):r>5&&(t.fillStyle=this.state.color,t.globalAlpha=.4,t.fillRect(s/n*i,o/n*r,s/n,o/n)),t.globalAlpha=1}t.beginPath(),t.moveTo(0,0),t.lineTo(0,o),t.lineTo(s,o),t.lineTo(s,0),t.lineTo(0,0),t.stroke()}},{key:"drawPawns",value:function(){var e=document.getElementById("canvasPawns"),t=e.getContext("2d"),a=this.state.board.length,n=e.width,s=e.height,o=this.state.pawns;t.clearRect(0,0,n,s),console.log("draw pawns");for(var r=0;r<o.length;r++){var l=o[r].position;-1===l.x&&-1===l.y||(console.log("drawing",this.getImage(o[r].name),n/a*l.x,s/a*l.y,n/a,s/a),t.drawImage(this.getImage(o[r].name),n/a*l.x,s/a*l.y,n/a,s/a))}}},{key:"onMessageRecieved",value:function(e){var t=JSON.parse(e.body);console.log(t,"recieved"),t.lobbyId===this.state.lobbyId&&t.receiver===this.state.user.id&&"START_GAME"===t.operation&&this.setState({board:t.fields,pawns:t.pawnList,opponent:t.opponent})}},{key:"handleMouseClick",value:function(e){var t=e.nativeEvent.layerX,a=e.nativeEvent.layerY,n=e.target.width,s=e.target.height;console.log(t,n),console.log(a,s),t=Math.floor(t/n*10),a=Math.floor(a/s*10),console.log(t,a),this.setState({mouseX:t,mouseY:a}),this.placePawn(this.state.pawns,this.state.selectedItem,t,a),this.drawPawns()}},{key:"placePawn",value:function(e,t,a,n){for(var s=0;s<e.length;s++)if(e[s].name===t&&(-1===e[s].position.x||-1===e[s].position.y)){e[s].position.x=a,e[s].position.y=n,console.log(t,"placed at","x:",a,"y:",n);break}this.setState({pawns:e})}},{key:"getBG",value:function(e){return"url("+e+")"}},{key:"selectPawn",value:function(e){console.log(e,"selected"),this.setState({selectedItem:e})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Online Stratego"),s.a.createElement("div",{className:"row"},s.a.createElement("div",{id:"left",className:"col-md"},this.createPawnButtons([B.a,q.a,_.a,H.a,z.a,G.a,L.a,T.a,P.a,U.a,A.a,O.a])),s.a.createElement("div",Object(c.a)({className:"center"},"className","col-md"),s.a.createElement("div",{className:"grid"},s.a.createElement("div",{className:"canvasWrapper"},s.a.createElement("canvas",{id:"canvasBoard",width:V.medium,height:Q.medium,onMouseDown:this.handleMouseClick.bind(this)})),s.a.createElement("div",{className:"canvasWrapper"},s.a.createElement("canvas",{id:"canvasPawns",width:V.medium,height:Q.medium,onMouseDown:this.handleMouseClick.bind(this)})))),s.a.createElement("div",{id:"right",className:"col-sm"},s.a.createElement("canvas",{id:"canvasDefeatedPawns",width:V.small,height:Q.medium}))))}},{key:"createPawnButtons",value:function(e){for(var t=this,a=[],n=0,o=0;o<e.length/2;o++)a.push(s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm"},s.a.createElement(K.a,{className:"btn-warning pawn",style:{backgroundImage:this.getBG(e[n])},title:this.getNameFromImport(e[n++]),onClick:function(e){return t.selectPawn(e.target.title)}})),s.a.createElement("div",{className:"col-sm"},s.a.createElement(K.a,{className:"btn-warning pawn",style:{backgroundImage:this.getBG(e[n])},title:this.getNameFromImport(e[n++]),onClick:function(e){return t.selectPawn(e.target.title)}}))));return a}},{key:"getNameFromImport",value:function(e){var t=e.indexOf("stratego-")+9,a=e.indexOf(".");return e=(e=e.slice(t,a)).replace(e[0],e[0].toUpperCase())}},{key:"getImage",value:function(e){var t=this.state.images.pawns;switch(e){case"Flag":return t.flag;case"Spy":return t.spy;case"Scout":return t.scout;case"Miner":return t.miner;case"Sergeant":return t.sergeant;case"Marshal":return t.marshal;case"Major":return t.major;case"Lieutenant":return t.lieutenant;case"General":return t.general;case"Colonel":return t.colonel;case"Captain":return t.captain;case"Bomb":return t.bomb;default:return e+" did not match any pawn."}}}]),t}(n.Component),te=a(122),ae="http://localhost:9000";function ne(e,t,a){if(t.length!==a.length)return"Parameter and values size does not match.";var n=[];n.push(ae,"/",e,"?");for(var s=0;s<t.length;s++)n.push(t[s],"=",a[s],"&");return n.join("")}var se=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={username:"",password:"",user:null},a.handleLogin=a.handleLogin.bind(Object(g.a)(a)),a.handleRegister=a.handleRegister.bind(Object(g.a)(a)),a.handleChangeUsername=a.handleChangeUsername.bind(Object(g.a)(a)),a.handleChangePassword=a.handleChangePassword.bind(Object(g.a)(a)),a}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){sessionStorage.setItem("lobbyId","")}},{key:"componentDidUpdate",value:function(e,t,a){t!==this.state&&console.log(this.state)}},{key:"handleErrors",value:function(e){if(!e.ok)throw Error(e.statusText);return e}},{key:"handleLogin",value:function(){var e=this,t=ne("login",["username","password"],[this.state.username,this.state.password]);fetch(t).then((function(e){return e.json()})).then((function(t){e.setState({user:t},(function(){console.log(e.state.user,"user"),e.state.user.id?"null"!==e.state.user.id?(console.log(e.state),sessionStorage.setItem("user",JSON.stringify(e.state.user)),window.location="/joinlobby"):window.alert("Could not find account with those credentials!"):window.alert("Could not fetch user!")}))}))}},{key:"handleRegister",value:function(){window.location="/register"}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Online Stratego"),s.a.createElement(te.a,{className:"Form",style:{backgroundColor:"rgba(235,200,70,0.9)"}},s.a.createElement(te.a.Group,null,s.a.createElement(te.a.Control,{className:"input",type:"text",id:"username",placeholder:"Username",autoComplete:"username",onChange:this.handleChangeUsername})),s.a.createElement(te.a.Group,null,s.a.createElement(te.a.Control,{className:"input",type:"password",id:"password",placeholder:"Password",autoComplete:"current-password",onChange:this.handleChangePassword})),s.a.createElement(te.a.Group,null,s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.handleLogin},"Login"),s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.handleRegister},"Register new account"))))}}]),t}(n.Component),oe=null,re=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).sendMessage=function(e,t){oe.send(e,{},JSON.stringify(t)),console.log(t,"SEND")},a.startGame=function(){2===a.state.playerList.length?(console.log("start game",Object(g.a)(a)),a.sendMessage("/app/lobby/startgame",new E(a.state.lobbyId,a.state.playerList))):window.alert("2 Players are needed for a game!")},a.state={user:null,lobbyId:null,playerList:[],buttonDisabled:!0},a.onMessageRecieved=a.onMessageRecieved.bind(Object(g.a)(a)),a.sendMessage=a.sendMessage.bind(Object(g.a)(a)),a}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.getSessionStorage(),this.connect()}},{key:"componentDidUpdate",value:function(e,t,a){}},{key:"getSessionStorage",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user")),lobbyId:sessionStorage.getItem("lobbyId")})}},{key:"connect",value:function(){var e=this,t=new w.a("http://localhost:9000/ws");(oe=y.Stomp.over(t)).connect({},(function(t){console.log(t.toString()),oe.subscribe("/topic/lobby",(function(t){e.onMessageRecieved(t)})),e.sendMessage("/app/lobby",new f(e.state.user.id,e.state.user.username,e.state.lobbyId))}))}},{key:"onMessageRecieved",value:function(e){var t=this,a=JSON.parse(e.body);console.log(a,"recieved"),a.receiver===this.state.user.id&&"NEW_LOBBY"===a.operation&&(this.setState({lobbyId:a.lobbyId,playerList:a.playerList}),sessionStorage.setItem("lobbyId",this.state.lobbyId)),a.lobbyId===this.state.lobbyId&&("JOINED_LOBBY"===a.operation?(this.setState({playerList:a.playerList}),this.state.playerList.forEach((function(e){e.id===t.state.user.id&&sessionStorage.setItem("color",e.color)})),2===this.state.playerList.size&&this.setState({buttonDisabled:!1})):"START_GAME"===a.operation&&(window.location="/game"))}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("div",{className:"row"},s.a.createElement("header",{className:"Header"},"Lobby:\xa0"),s.a.createElement("header",{className:"lobby-id"},this.state.lobbyId&&this.state.lobbyId)),s.a.createElement("div",{className:"container",style:{width:"60%"}},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm"},this.createInfoBlockFromPlayer(0)),s.a.createElement("div",{className:"col-sm"},this.createInfoBlockFromPlayer(1))),s.a.createElement("div",{className:"row",style:{paddingTop:"1rem"}},s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.startGame},"Start Game"))))}},{key:"createInfoBlockFromPlayer",value:function(e){if(this.state.playerList[e]){var t,a=this.state.playerList[e];return t="RED"===a.color?"rgba(200, 0, 0, 0.85":"BLUE"===a.color?"rgba(0, 0, 200, 0.85":"rgba(235, 200, 70, 0.85",s.a.createElement("div",{className:"Form player-info",style:{backgroundColor:t}},s.a.createElement("p",{className:"player-name"},a.username),s.a.createElement("p",{className:"player-info"},a.color))}return s.a.createElement("div",{className:"Form player-info",style:{backgroundColor:"rgba(235, 200, 70, 0.85)"}},s.a.createElement("p",{className:"player-name"},"Waiting for player.."))}}]),t}(n.Component),le=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={username:"",password:"",user:null},a.handleLogin=a.handleLogin.bind(Object(g.a)(a)),a.handleRegister=a.handleRegister.bind(Object(g.a)(a)),a.handleChangeUsername=a.handleChangeUsername.bind(Object(g.a)(a)),a.handleChangePassword=a.handleChangePassword.bind(Object(g.a)(a)),a.handleChangePasswordConf=a.handleChangePasswordConf.bind(Object(g.a)(a)),a.toLogin=a.toLogin.bind(Object(g.a)(a)),a}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){t!==this.state&&console.log(this.state)}},{key:"handleErrors",value:function(e){if(!e.ok)throw Error(e.statusText);return e}},{key:"handleLogin",value:function(){window.location="/"}},{key:"handleRegister",value:function(){var e=this.state.username,t=this.state.password;if(t===this.state.passwordConfirmation)if("null"!==e){var a=ne("register",["username","password"],[e,t]);fetch(a).then((function(e){return e.json()})).then((function(e){console.log(e,"data"),"null"!==e.id||"null"!==e.username?window.location="/":window.alert("Could not create account! Unkown error.")}))}else window.alert("Username cannot be null.");else window.alert("Passwords do not match.")}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleChangePasswordConf",value:function(e){this.setState({passwordConfirmation:e.target.value})}},{key:"toLogin",value:function(){window.location="/"}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Online Stratego"),s.a.createElement(te.a,{className:"Form",style:{backgroundColor:"rgba(235,200,70,0.9)"}},s.a.createElement(te.a.Group,null,s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.toLogin},"Back to login")),s.a.createElement(te.a.Group,null,s.a.createElement(te.a.Control,{className:"input",type:"text",id:"username",placeholder:"Username",onChange:this.handleChangeUsername})),s.a.createElement(te.a.Group,null,s.a.createElement(te.a.Control,{className:"input",type:"password",id:"password",placeholder:"Password",autoComplete:"new-password",onChange:this.handleChangePassword})),s.a.createElement(te.a.Group,null,s.a.createElement(te.a.Control,{className:"input",type:"password",id:"passwordConf",placeholder:"Confirm password",autoComplete:"new-password",onChange:this.handleChangePasswordConf})),s.a.createElement(te.a.Group,null,s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.handleRegister},"Create account"))))}}]),t}(n.Component),ie=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={user:null,lobbyId:""},a.changeLobbyId=a.changeLobbyId.bind(Object(g.a)(a)),a.createLobby=a.createLobby.bind(Object(g.a)(a)),a.joinLobby=a.joinLobby.bind(Object(g.a)(a)),a}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.getUser()}},{key:"componentDidUpdate",value:function(e,t,a){console.log(this.state,"state")}},{key:"getUser",value:function(){this.setState({user:JSON.parse(sessionStorage.getItem("user"))})}},{key:"changeLobbyId",value:function(e){this.setState({lobbyId:e.target.value.toUpperCase()})}},{key:"createLobby",value:function(){sessionStorage.setItem("lobbyId",""),sessionStorage.setItem("color",""),window.location="/lobby"}},{key:"joinLobby",value:function(){5===this.state.lobbyId.length?(sessionStorage.setItem("lobbyId",this.state.lobbyId),window.location="/lobby"):window.alert("Lobby ID must be 5 characters!")}},{key:"render",value:function(){return s.a.createElement("div",{className:"Layout"},s.a.createElement("header",{className:"Header"},"Create or join lobby"),s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm"},s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.createLobby},"Create new lobby")),s.a.createElement("div",{className:"col-sm"},s.a.createElement(te.a.Group,null,s.a.createElement(K.a,{className:"btn btn-warning",onClick:this.joinLobby},"Join a private lobby"),s.a.createElement(te.a.Control,{className:"input upper-case",type:"text",id:"lobbyId",maxLength:"5",placeholder:"Lobby ID",onChange:this.changeLobbyId}))))))}}]),t}(n.Component);var ce=function(){return s.a.createElement(l.a,null,s.a.createElement("div",{className:"App"},s.a.createElement(i.a,{path:"/",exact:!0,component:se}),s.a.createElement(i.a,{path:"/register",exact:!0,component:le}),s.a.createElement(i.a,{path:"/game",exact:!0,component:ee}),s.a.createElement(i.a,{path:"/lobby",exact:!0,component:re}),s.a.createElement(i.a,{path:"/joinlobby",exact:!0,component:ie})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(ce,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},38:function(e,t,a){e.exports=a.p+"static/media/stratego-bomb.f4d3b4d8.webp"},39:function(e,t,a){e.exports=a.p+"static/media/stratego-captain.dc2fd759.webp"},40:function(e,t,a){e.exports=a.p+"static/media/stratego-colonel.197e1ee4.webp"},41:function(e,t,a){e.exports=a.p+"static/media/stratego-flag.e14abb9a.webp"},42:function(e,t,a){e.exports=a.p+"static/media/stratego-general.fb480ab3.webp"},43:function(e,t,a){e.exports=a.p+"static/media/stratego-lieutenant.9df8eab2.webp"},44:function(e,t,a){e.exports=a.p+"static/media/stratego-major.92d1a53c.webp"},45:function(e,t,a){e.exports=a.p+"static/media/stratego-marshal.aab1378a.webp"},46:function(e,t,a){e.exports=a.p+"static/media/stratego-miner.94171ebf.webp"},47:function(e,t,a){e.exports=a.p+"static/media/stratego-scout.dc487852.webp"},48:function(e,t,a){e.exports=a.p+"static/media/stratego-sergeant.11eaead2.webp"},49:function(e,t,a){e.exports=a.p+"static/media/stratego-spy.90de642a.webp"},71:function(e,t,a){e.exports=a.p+"static/media/grass.fac09060.png"},72:function(e,t,a){e.exports=a.p+"static/media/water.597de213.png"},77:function(e,t,a){e.exports=a(121)},82:function(e,t,a){},83:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){}},[[77,1,2]]]);
//# sourceMappingURL=main.e2118b95.chunk.js.map